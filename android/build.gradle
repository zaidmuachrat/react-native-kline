// android/build.gradle

def DEFAULT_COMPILE_SDK_VERSION = 33  // You can replace this with your desired SDK version
def DEFAULT_BUILD_TOOLS_VERSION = '30.0.3'  // Replace with your required build tools version
def DEFAULT_MIN_SDK_VERSION = 16  // Adjust if needed
def DEFAULT_TARGET_SDK_VERSION = 34  // Adjust if needed

apply plugin: 'com.android.library'
apply plugin: 'maven-publish'

android {
    // Replaced `safeExtGet` with direct values
    compileSdkVersion DEFAULT_COMPILE_SDK_VERSION
    buildToolsVersion DEFAULT_BUILD_TOOLS_VERSION

    defaultConfig {
        minSdkVersion DEFAULT_MIN_SDK_VERSION
        targetSdkVersion DEFAULT_TARGET_SDK_VERSION
        versionCode 1
        versionName "1.0"
    }

    lintOptions {
        abortOnError false
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}

repositories {
    // Repositories for dependencies
    mavenLocal()
    maven {
        url "$rootDir/../node_modules/react-native/android"
    }
    maven {
        url "$rootDir/../node_modules/jsc-android/dist"
    }
    google()
    jcenter()
}

dependencies {
    // Core dependencies for React Native and other libraries
    implementation 'com.facebook.react:react-native:+'
    implementation 'androidx.appcompat:appcompat:1.2.0'
    implementation 'androidx.recyclerview:recyclerview:1.1.0'
    implementation 'org.jetbrains:annotations:15.0'
    implementation 'com.google.code.gson:gson:2.8.6'
}

def configureReactNativePom(def pom) {
    // Function to configure the Maven POM file
    def packageJson = new groovy.json.JsonSlurper().parseText(file('../package.json').text)

    pom.withXml {
        def root = asNode()
        root.appendNode('name', packageJson.title)
        root.appendNode('artifactId', packageJson.name)
        root.appendNode('version', packageJson.version)
        root.appendNode('group', "com.byron.kline")
        root.appendNode('description', packageJson.description)
    }
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            groupId 'com.byron.kline'
            artifactId 'your-artifact-id'
            version '1.0'

            afterEvaluate {
                from components.release
            }

            pom.withXml {
                asNode().appendNode('name', 'your-artifact-name')
            }
        }
    }

    repositories {
        maven {
            url "file://${projectDir}/../android/maven"
        }
    }
}

afterEvaluate { project ->
    task androidJavadoc(type: Javadoc) {
        source = android.sourceSets.main.java.srcDirs
        classpath += files(android.bootClasspath)
        classpath += files(project.getConfigurations().getByName('default').asList())
        include '**/*.java'
    }

    task androidJavadocJar(type: Jar, dependsOn: androidJavadoc) {
        classifier = 'javadoc'
        from androidJavadoc.destinationDir
    }

    task androidSourcesJar(type: Jar) {
        classifier = 'sources'
        from android.sourceSets.main.java.srcDirs
        include '**/*.java'
    }

    android.libraryVariants.all { variant ->
        def name = variant.name.capitalize()
        def javaCompileTask = variant.javaCompileProvider.get()

        task "jar${name}"(type: Jar, dependsOn: javaCompileTask) {
            from javaCompileTask.destinationDir
        }
    }

    artifacts {
        archives androidSourcesJar
        archives androidJavadocJar
    }
}
